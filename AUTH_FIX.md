# Исправления авторизации

## Что было исправлено

1. ✅ Добавлен `AuthProvider` в `App.tsx`
2. ✅ Обновлена страница `/auth` для работы с Supabase (OTP вместо пароля)
3. ✅ Обновлен `ProtectedRoute` для использования нового AuthContext
4. ✅ Обновлен `auth-utils.ts` - редирект на `/auth` вместо `/api/login`
5. ✅ Создан адаптер в `use-auth.ts` для совместимости со старым кодом

## Как проверить

1. **Откройте http://localhost:5000/auth** (НЕ `/api/login`!)

2. **Проверьте консоль браузера (F12)**:
   - Не должно быть ошибок о Supabase
   - Должно быть: `Supabase credentials configured` (или подобное)

3. **Попробуйте авторизоваться**:
   - Введите email
   - Нажмите "Отправить код"
   - Проверьте почту - должен прийти код от Supabase
   - Введите код и нажмите "Подтвердить"

## Если не работает

### Проблема: "Supabase не настроен"

**Решение:**
1. Проверьте файл `.env` в корне проекта
2. Убедитесь, что есть:
   ```
   VITE_SUPABASE_URL=https://ionriyybabiuebxwmvoc.supabase.co
   VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```
3. Перезапустите сервер:
   ```bash
   # Остановите (Ctrl+C) и запустите снова:
   npm run dev
   ```

### Проблема: "Код не приходит на email"

**Решение:**
1. Проверьте папку "Спам" в почте
2. Убедитесь, что email правильный
3. В Supabase Dashboard → Authentication → Email Templates проверьте настройки

### Проблема: "Ошибка при отправке кода"

**Решение:**
1. Откройте консоль браузера (F12) → вкладка Console
2. Посмотрите точную ошибку
3. Проверьте в Supabase Dashboard → Authentication → Settings:
   - Email auth включен
   - Confirm email отключен (для разработки)

## Важно

- **НЕ используйте `/api/login`** - это старый эндпоинт Replit Auth
- Используйте **`/auth`** для авторизации
- Все редиректы теперь ведут на `/auth`
